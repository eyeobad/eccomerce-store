{% extends "base.html" %}
{% load static %}
{% block title %}E Store - Cart Page{% endblock %}

{% block extra_head %}
<style>
  /* Mobile-specific styling */
  @media (max-width: 767px) {
      /* Adjust table font size for mobile */
      .cart-page .table-responsive table {
          font-size: 14px;
      }
      /* Center table content */
      .cart-page .table-responsive table th,
      .cart-page .table-responsive table td {
          text-align: center;
          vertical-align: middle;
      }
      /* Make product images smaller */
      .cart-page .img img {
          width: 60px;
          height: auto;
      }
      /* Adjust quantity input styling */
      .cart-page .qty input {
          width: 70px;
          padding: 5px;
          font-size: 14px;
      }
      /* Cart buttons: Increase tap area */
      .cart-btn button,
      .cart-btn a.btn {
          font-size: 16px;
          padding: 10px 20px;
      }
      /* Adjust cart summary padding and font size */
      .cart-summary .cart-content {
          padding: 15px;
          font-size: 16px;
      }
  }
</style>
{% endblock extra_head %}

{% block content %}
    <!-- Breadcrumb Start -->
    {% include 'breadcrumb.html' %}
    <!-- Breadcrumb End -->

    <!-- Cart Start -->
    <div class="cart-page">
        <div class="container-fluid">
            <div class="row">
                <!-- Cart Items -->
                <div class="col-lg-8">
                    <form method="post" action="{% url 'myapp:update_cart' %}">
                        {% csrf_token %}
                        <div class="cart-page-inner">
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th>Product</th>
                                            <th>Price</th>
                                            <th>Quantity</th>
                                            <th>Total</th>
                                            <th>Remove</th>
                                        </tr>
                                    </thead>
                                    <tbody class="align-middle">
                                        {% if cart_items %}
                                            {% for item in cart_items %}
                                            <tr>
                                                <td>
                                                    <div class="img">
                                                        <a href="{% url 'myapp:product_detail' item.product.id %}">
                                                            {% if item.product.image %}
                                                                <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                                                            {% else %}
                                                                <img src="{% static 'img/default-product.jpg' %}" alt="Default Product">
                                                            {% endif %}
                                                        </a>
                                                        <p>{{ item.product.name }}</p>
                                                    </div>
                                                </td>
                                                <td>₦{{ item.product.price }}</td>
                                                <td>
                                                    <!-- Quantity Input with Orange Styling -->
                                                    <div class="qty" style="background-color: #fff;">
                                                        <input 
                                                            type="number" 
                                                            name="quantity_{{ item.id }}" 
                                                            value="{{ item.quantity }}" 
                                                            min="1" 
                                                            class="orange-qty"
                                                        >
                                                    </div>
                                                </td>
                                                <td>₦{{ item.total }}</td>
                                                <td>
                                                    <a href="{% url 'myapp:remove_from_cart' item.id %}">
                                                        <i class="fa fa-trash"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        {% else %}
                                            <tr>
                                                <td colspan="5">Your cart is empty.</td>
                                            </tr>
                                        {% endif %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Update Cart Button -->
                        <div class="cart-btn" style="margin-top: 10px;">
                            <button type="submit" class="btn btn-primary">Update Cart</button>
                        </div>
                    </form>
                </div>

                <!-- Cart Summary and Coupon -->
                <div class="col-lg-4">
                    <div class="cart-page-inner">
                        <div class="row">
                            <div class="col-md-12">
                                <div class="coupon">
                                    {% if cart.coupon %}
                                        <p>
                                            Coupon Applied: <strong>{{ cart.coupon.code }}</strong>
                                            ({{ cart.coupon.discount }}% off)
                                        </p>
                                    {% else %}
                                        <form method="post" action="{% url 'myapp:apply_coupon' %}" id="coupon-form">
                                            {% csrf_token %}
                                            <input type="text" name="coupon_code" placeholder="Coupon Code">
                                            <button type="submit">Apply Code</button>
                                        </form>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div class="cart-summary">
                                    <div class="cart-content">
                                        <h1>Cart Summary</h1>
                                        <p>Sub Total<span>₦{{ cart.get_subtotal }}</span></p>
                                        {% if cart.coupon %}
                                            <p>Discount<span>-₦{{ cart.get_discount }}</span></p>
                                        {% endif %}
                                        <p>Shipping Cost<span>₦{{ shipping_cost }}</span></p>
                                        <h2>Grand Total<span>₦{{ cart.get_total }}</span></h2>
                                    </div>
                                    <div class="cart-btn">
                                        {% if user.is_authenticated %}
                                            <a href="{% url 'myapp:checkout' %}" class="btn">Checkout</a>
                                        {% else %}
                                            <a href="{% url 'myapp:login' %}?next={{ request.path }}" class="btn btn-warning">Login to Checkout</a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Cart Summary -->
            </div>
        </div>
    </div>
    <!-- Cart End -->
{% endblock content %}
